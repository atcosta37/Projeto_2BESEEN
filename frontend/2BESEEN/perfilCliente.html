<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="src/css/header.css">
    <link rel="stylesheet" href="src/css/carrinho.css">
    <title>Perfil do Cliente</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f4f4f4; }
.perfil-flex {
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    justify-content: center;
    gap: 40px;
    margin: 48px auto 40px auto;
    max-width: 1200px;
}

.perfil-dados {
    width: 100%;
    max-width: 400px;
    background: #fff;
    border-radius: 14px;
    box-shadow: 0 4px 18px rgba(0,0,0,0.08);
    padding: 38px 32px 32px 32px;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}
.perfil-encomendas {
    flex: 1;
    min-width: 1000px;      /* aumenta aqui */
    max-width: 900px; 
    background: #fff;
    border-radius: 14px;
    box-shadow: 0 4px 18px rgba(0,0,0,0.08);
    padding: 38px 32px 32px 32px;
    overflow-x: auto;
}
        .perfil-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 28px;
        }
        .perfil-header h2 {
            margin: 0;
            color: #ff6600;
            font-size: 2em;
        }
       .dados-pessoais-simples {
    width: 100%;
    margin-bottom: 22px;
    display: flex;
    flex-direction: column;
    gap: 6px;
}
.dados-label {
    font-weight: 600;
    color: #232526;
    font-size: 1.05em;
}
.dados-valor {
    color: #444;
    margin-bottom: 6px;
    font-size: 1.05em;
    word-break: break-all;
}
.dados-botoes {
    display: flex;
    gap: 12px;
    margin-top: 8px;
}
.dados-botoes button {
    background: #ff6600;
    color: #fff;
    border: none;
    border-radius: 6px;
    padding: 7px 18px;
    font-size: 1em;
    cursor: pointer;
    transition: background 0.2s;
}
.dados-botoes button:hover { background: #e65c00; }
        table {
    width: 100%;
    max-width: 100%;
    border-collapse: collapse;
    margin-top: 16px;
    background: #fff;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 2px 8px #ff660012;
}
        th, td {
            padding: 12px 10px;
            border-bottom: 1px solid #eee;
            text-align: left;
        }
        th {
            background: #f7f7f7;
            color: #232526;
            font-weight: 600;
        }
        .estado-pendente { color: #ff9800; }
        .estado-em-processamento { color: #2196f3; }
        .estado-concluido { color: #4caf50; }
        .estado-enviado { color: #9c27b0; }
        .detalhes-btn {
            background: #ff6600;
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 6px 14px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.2s;
        }
        .detalhes-btn:hover { background: #e65c00; }
        #detalhesModal {
            display: none;
            position: fixed;
            left: 0; top: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.4);
            z-index: 1000;
        }
        #detalhesModal .modal-content {
            background: #fff;
            max-width: 400px;
            margin: 80px auto;
            padding: 24px;
            border-radius: 10px;
            position: relative;
            box-shadow: 0 4px 24px #ff660044;
        }
        #detalhesModal .close {
            position: absolute;
            right: 16px;
            top: 12px;
            font-size: 22px;
            cursor: pointer;
        }
        @media (max-width: 700px) {
            .perfil-flex {
                flex-direction: column;
                align-items: center;
                gap: 32px;
                margin: 24px 0;
            }
            .perfil-dados, .perfil-encomendas {
                max-width: 100%;
                width: 100%;
                padding: 24px 8vw;
            }
        }
        footer {
            background-color: #232526;
            color: white;
            padding: 14px 0;
            position: fixed;
            bottom: 0;
            width: 100%;
            font-size: 1em;
            letter-spacing: 0.5px;
            z-index: 100;
        }
    </style>
</head>
<body>
<header>
    <nav class="main-navbar">
        <div class="logo-area">
            <img src="/logo.png" alt="2beSeen" class="logo-img">
            <span class="brand-title">2BESEEN <span class="brand-sub">Impress√£o de Qualidade</span></span>
        </div>
        <div class="nav-links">
            <a href="/index.html">Home</a>
            <a href="/servicos.html">Servi√ßos</a>
            <a href="/portfolio.html">Portf√≥lio</a>
            <div class="dropdown">
                <a href="#" onclick="toggleSubMenu(event)">A Empresa &#9662;</a>
                <div id="submenu" class="submenu">
                    <a href="oque-somos.html">O Que Somos</a>
                    <a href="quem-somos.html">Quem Somos</a>
                    <a href="equipa.html">A Equipa</a>
                </div>
            </div>
            <a href="/contactos.html">Contactos</a>
        </div>
        <div class="header-actions">
            <button onclick="toggleCarrinho()" class="carrinho-button" title="Ver Carrinho">üõí</button>
            <a href="/login.html" class="login-button">Login</a>
            <div id="perfilCliente" class="perfil-container">
                <span>Bem-vindo, <span id="nomeCliente"></span></span>
                <a href="perfilCliente.html" class="perfil-btn" id="perfilBtn">Perfil</a>
            </div>
        </div>
        <button class="openbtn" onclick="toggleMenu()">&#9776;</button>
    </nav>
    <div id="carrinhoContainer" class="carrinho-container">
        <button onclick="toggleCarrinho()" class="carrinho-fechar" title="Fechar" style="background:none; border:none; position:absolute; top:18px; right:18px; font-size:1.5em; color:#ff6600; cursor:pointer;">‚úï</button>
        <h3 style="color:#ff6600; margin-top:0; margin-bottom:22px; text-align:center;">
            <span style="font-size:1.2em;">üõí</span> Carrinho
        </h3>
        <ul id="carrinhoLista" style="list-style:none; padding:0; margin:0 0 18px 0; min-height:40px;"></ul>
        <div id="carrinhoTotal" style="font-weight:bold; font-size:18px; color:#e65c00; text-align:right; margin-bottom:18px;"></div>
        <button onclick="confirmarPedido()" class="carrinho-confirmar" style="background:#ff6600; color:#232526; border:none; border-radius:8px; padding:12px 0; font-weight:600; font-size:1.1rem; cursor:pointer; width:100%; box-shadow:0 2px 8px #ff660033;">Confirmar Pedido</button>
        <div id="carrinhoVazio" style="display:none; text-align:center; color:#aaa; margin-top:18px;">
            <span style="font-size:2em;">üõçÔ∏è</span><br>
            O seu carrinho est√° vazio.
        </div>
    </div>
</header>
<main>
    <div class="perfil-flex">
    <!-- Substitui apenas o conte√∫do de .perfil-dados -->
        <div class="perfil-dados">
            <h2 style="color:#ff6600; margin-bottom:24px;">Perfil do Cliente</h2>
            <div class="dados-pessoais-simples">
                <div class="dados-label">Nome:</div>
                <div class="dados-valor" id="perfilNomeCliente"></div>
                <div class="dados-label">Email:</div>
                <div class="dados-valor" id="perfilEmailCliente"></div>
            </div>
            <div class="dados-botoes">
                <button onclick="editarDados()">Editar Dados</button>
                <button onclick="logout()">Logout</button>
            </div>
        </div>
        <div class="perfil-encomendas">
            <h3>As minhas encomendas</h3>
            <table id="tabelaEncomendas">
                <thead>
                    <tr>
                        <th>Tamanho</th>
                        <th>Papel/Material</th>
                        <th>Quantidade</th>
                        <th>Arquivo</th>
                        <th>Tipo de Servi√ßo</th>
                        <th>Data</th>
                        <th>Estado</th>
                        <th>Detalhes</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    <!-- Modal para detalhes da encomenda -->
    <div id="detalhesModal">
        <div class="modal-content">
            <span class="close" onclick="fecharModal()">&times;</span>
            <h4>Detalhes da Encomenda</h4>
            <div id="detalhesConteudo"></div>
        </div>
    </div>
</main>
<footer>
    &copy; 2025 2beSeen - Todos os direitos reservados.
</footer>
<script src="src/js/global.js"></script>
<script src="src/js/header.js"></script>
<script src="src/js/carrinho.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", async () => {
        const token = localStorage.getItem("jwtToken");
        if (!token) {
            alert("Precisa de estar autenticado.");
            window.location.href = "/login";
            return;
        }
        // Buscar dados pessoais
        try {
            const resUser = await fetch("/api/users/minhas", {
                headers: { "Authorization": token }
            });
            if (resUser.ok) {
                const user = await resUser.json();
                document.getElementById("perfilNomeCliente").textContent = user.nome || "";
                document.getElementById("perfilEmailCliente").textContent = user.email || "";
            } else {
                alert("Erro ao carregar dados do utilizador.");
            }
        } catch (err) {
            alert("Erro ao carregar dados do utilizador.");
        }
        // Buscar encomendas do pr√≥prio utilizador
        try {
            const resposta = await fetch('/api/orders/minhas', {
                headers: { 'Authorization': token }
            });
            if (!resposta.ok) throw new Error("N√£o autorizado");
            const encomendas = await resposta.json();
            const tbody = document.querySelector("#tabelaEncomendas tbody");
            encomendas.forEach(pedido => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${pedido.tamanho || ''}</td>
                    <td>${pedido.papel || ''}</td>
                    <td>${pedido.quantidade || ''}</td>
                    <td>${pedido.arquivo || ''}</td>
                    <td>${pedido.tipoServico || ''}</td>
                    <td>${pedido.dataPedido ? new Date(pedido.dataPedido).toLocaleString() : ''}</td>
                    <td class="estado-${pedido.estado?.replace(/ /g,'-')}">${pedido.estado || ''}</td>
                    <td><button class="detalhes-btn" onclick='mostrarDetalhes(${JSON.stringify(pedido)})'>Ver</button></td>
                `;
                tbody.appendChild(tr);
            });
        } catch (err) {
            console.error("Erro ao buscar encomendas:", err);
            alert("Erro ao carregar encomendas.");
        }
    });
    function mostrarDetalhes(encomenda) {
        const div = document.getElementById("detalhesConteudo");
        div.innerHTML = `
            <p><strong>Tamanho:</strong> ${encomenda.tamanho || ''}</p>
            <p><strong>Papel:</strong> ${encomenda.papel || ''}</p>
            <p><strong>Quantidade:</strong> ${encomenda.quantidade || ''}</p>
            <p><strong>Arquivo:</strong> ${encomenda.arquivo || ''}</p>
            <p><strong>Tipo de Servi√ßo:</strong> ${encomenda.tipoServico || ''}</p>
            <p><strong>Data:</strong> ${encomenda.dataPedido ? new Date(encomenda.dataPedido).toLocaleString() : ''}</p>
            <p><strong>Estado:</strong> ${encomenda.estado || ''}</p>
            <p><strong>Valor:</strong> ${encomenda.precoEstimado ? encomenda.precoEstimado.toFixed(2) + " ‚Ç¨" : 'N/A'}</p>
        `;
        document.getElementById("detalhesModal").style.display = "block";
    }
    function fecharModal() {
        document.getElementById("detalhesModal").style.display = "none";
    }
    function editarDados() {
        alert("Funcionalidade de edi√ß√£o ainda n√£o implementada.");
    }
    function logout() {
        localStorage.removeItem("jwtToken");
        window.location.href = "/login";
    }
    window.mostrarDetalhes = mostrarDetalhes;
    window.fecharModal = fecharModal;
</script>
</body>
</html>